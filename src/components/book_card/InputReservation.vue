<template>
    <div class="input_container">
        <div class="left_box box">
            <dt>
              개인정보 수집 및 이용 동의  
            </dt>
            <div class="dd"> 
                <div style="margin: 0.8rem 0.8rem; font-size:0.8rem">
                    <span>※ 방탈출 단편선은 이용자의 개인정보를 중요시하며, "개인정보보호법, 정보통신망 이용촉진 및 정보보호 등에 관한 법률 등"에 관한 법률을 준수하고 있습니다.</span><br/>
                <br/><br/>
                <span class="ddTitle">■ 개인정보의 수집 및 이용목적</span><br />
                <div class="ddSubContent">
                <span>방탈출 단편선은 수집한 개인정보는 다음의 목적을 위해 활용합니다.</span>
                </div><br/>
                    <div class="ddSubTitle"> 
                    <span>
                        가) 예약 서비스 제공을 위한 계약 이행 및 정산
                    </span>
                    </div>
                    <div class="ddSubContent">
                        <span>(1)&nbsp;예약 서비스 제공에 관한 계약 이행과 예약자 확인, 요금 결제, 예약 취소와 환불 등 </span>
                    </div><br/>
                    <div class="ddSubTitle">
                        <span>
                            나) 회원 관리 및 홈페이지 서비스 제공
                        </span>
                    </div>
                    <div class="ddSubContent">
                        <span> (1)&nbsp;회원제 서비스 이용에 따른 본인확인기관을 통한 본인인증, 개인식별, 불량회원의 부정 이용방지와 
                            비인가 사용방지, 가입 의사 확인
                        </span><br/>
                    </div>
                    <div class="ddSubContent">    
                        <span>    
                           (2)&nbsp;Q&A를 통한 문의 서비스, 후기 작성 등에 필요한 기록보존
                        </span>
                    </div><br/><br/>
                    <span class="ddTitle">■ 수집하는 개인정보 항목 및 수집방법</span><br /><br/> 
                    <div class="ddSubTitle"> 
                    <span>
                        가) 수집하는 개인정보 항목
                    </span>
                    </div><br/>
                     <div class="ddSubContent">
                        <span>(1)&nbsp; 회원가입: 이름,전화번호,아이디,비밀번호,가입날짜,이메일,  </span>
                    </div>
                     <div class="ddSubContent">
                        <span>(2)&nbsp; 비회원 예약: 이름,전화번호,이메일,  </span>
                    </div>
                    <div class="ddSubContent">
                        <span>(3)&nbsp;서비스 이용과정에서 아래와 같은 정보들이 자동으로 생성되어 수집 될 수 있는 항목: IP Address, 쿠키</span>
                    </div>
                    <div class="ddSubContent">
                        <span>(4)&nbsp; 결제 서비스 이용 과정 시 수집하는 정보: 신용카드(카드사명, 카드번호), 휴대폰(휴대폰번호, 통신사, 결제승인번호), 계좌이체(은행명, 계좌번호)
                    </span>
                    </div>
                     <div class="ddSubContent">
                        <span>(5)&nbsp;수집하는 개인정보는 서비스 제공에 필요한 최소한의 정보만으로 한정되며, 회원(고객)의 기본적 인권을 침해할 우려가 있는 민감한 개인정보(인종, 종교, 사상, 출신지, 본적지, 정치적 성향 및 범죄기록, 건강상태 및 성생활 등)는 수집하지 않습니다.
                    </span>
                    </div><br/>
                    <div class="ddSubTitle"> 
                    <span>
                        나) 수집 방법
                    </span>
                   </div>
                    <div class="ddSubContent">
                        <span>(1)&nbsp;개인정보 수집방법 : 홈페이지, 카카오톡 플러스친구, 서면양식, 전화, 이메일
                    </span>
                    </div><br/>
                    <div class="ddSubTitle"> 
                    <span>
                        다) 동의 여부
                    </span>
                   </div>
                    <div class="ddSubContent">
                        <span>
                            (1)&nbsp;동의를 거부할 권리 및 동의를 거부할 시 불이익: 위 개인 정보의 수집 및 이용에 동의하시지 않을 경우 회원의 가입 및 예약 서비스 제공이 불가능합니다.
                        </span>
                    </div><br/>
                    <span class="ddTitle">■ 개인정보 및 고유식별정보의 보유 및 이용기간</span><br /><br/> 
                    <div class="ddSubTitle"> 
                    <span>
                        가) 관계법령 예시
                    </span>
                    </div>
                    <div class="ddSubContent">
                        <span>
                           상법, 전자상거래 등에서의 소비자보호에 관한 법률 등 관계법령의 규정에 의하여 보존할 필요가 있는 경우 회사는 관계법령에서 정한 일정한 기간 동안 회원정보를 보관합니다. 이 경우 회사는 보관하는 정보를 그 보관의 목적으로만 이용하며 보존기간은 아래와 같습니다. 
                        </span><br/><br>
                        <span>
                            - 계약 또는 청약철회 등에 관한 기록: 5년 (전자상거래 등에서의 소비자보호에 관한 법률)
                        </span><br/>
                        <span>
                            - 거래에 관한 장부 및 증거서류: 5년 (국세기본법)
                        </span><br/>
                        <span>
                            - 대금결제 및 재화 등의 공급에 관한 기록: 5년 (전자상거래등에서의 소비자보호에 관한 법률)
                        </span>
                        <span>
                            - 소비자의 불만 또는 분쟁처리에 관한 기록: 3년 (전자상거래 등에서의 소비자보호에 관한 법률)
                        </span>              
                    </div><br/>
                    <div class="ddSubTitle"> 
                    <span>
                        나)&nbsp;12개월 이상 서비스 장기 미이용자의 개인정보를 파기하거나 다른 정보와 별도로 분리하여 저장관리하며, 개인정보를 파기 또는 분리 저장하기 전 이를 회원에게 전자우편· 서면· 팩스· 전화 등의 방법으로 통지합니다.
                    </span>
                    </div><br/>
                    <span class="ddTitle">■ 개인정보의 파기절차 및 방법</span><br /><br/> 
                    <div class="ddSubTitle"> 
                    <span>
                        가) 파기 절차
                    </span>
                    </div>
                    <div class="ddSubContent">
                        <span>
                            -&nbsp;회원가입 시 입력한 정보는 목적이 달성된 후 별도의 DB로 옮겨져(종이의 경우 별도의 서류함) 내부 방침 및 기타 관련 법령에 의한 정보보호 사유에 따라(보유 및 이용기간 참조) 일정 기간 저장된 후 파기됩니다.
                        </span>
                        <span>
                            -&nbsp;별도 DB로 옮겨진 개인정보는 법률에 의한 경우가 아니고서는 보유되어지는 이외의 다른 목적으로 이용되지 않습니다.
                        </span>
                    </div><br/>
                    <span>
                        나) 파기 방법
                    </span>
                    <div class="ddSubContent">
                        <span>
                            -&nbsp;전자적 파일형태로 저장된 개인정보는 기록을 재생할 수 없는 기술적 방법을 사용하여 삭제합니다.
                        </span>
                         <span>
                            -&nbsp;종이에 출력된 개인정보는 분쇄기로 분쇄하거나 소각을 통하여 파기합니다.
                        </span>
                    </div><br/>
                    <span class="ddTitle">■ 개인정보의 열람 및 정정</span><br/>
                    <div class="ddSubContent">
                        <span>
                           -&nbsp;회원(고객)은 언제든지 등록되어 있는 본인의 개인정보를 열람하거나 정정하실 수 있습니다.
                        </span>
                    </div><br/>

                </div>
            </div>
            <div class="agreeCheckBox"> 
                <b-form-checkbox
                    id="checkbox-1"
                    v-model="privacy_agree"
                    name="checkbox-1"
                    value=true
                    unchecked-value=false
                >
                개인정보 수집 및 이용에 동의합니다.
                </b-form-checkbox>
            </div>
        </div>
        <div class="right_box">
            <div class="inputBox box">
                <dt style="margin-bottom:2.2rem">
                예약자 정보 입력  
                </dt>
                <div class="inputItem">
                    <div class="label">
                        <span>예약자명 </span>
                    </div>
                    <div>
                        <b-form-input id="input-name" :state="hasWrongName" v-on:blur="nameBlur" v-model="name" style="width: 20rem;" class="inline"></b-form-input>
                    </div>  
                </div>
                <div>
                    <p class="errorMessage">{{nameBlurErrorMessage}}</p>
                    <br/>
                </div>    
                <div class="inputItem">
                    <div class="label">
                        <span>전화번호 </span>
                    </div>
                    <div>
                        <select v-model="number1" class="form-control input-num" style="width: 5.2rem; height: 3rem; font-size: 1.4rem;">
                            <option :key="index "  class="input-num" v-for="(num, index) in id_number">
                                {{num}}
                            </option> 
                        </select>    
                        <span style="font-size:1.5rem; margin:0rem 0.25rem">-</span>
                        <div class="inline" :class="{wrongNumberLine: hasWrongNumber == false}">
                            <input type="text" class="form-control" v-model="number2" v-on:blur="numberBlur" style="width: 6rem;" />
                            <span style="font-size:1.5rem; margin:0rem 0.25rem">-</span>
                            <input type="text" class="form-control" v-model="number3" v-on:blur="numberBlur" style="width: 6rem;" />
                        </div>
                    </div> 
                </div>
                 <p class="errorMessage">{{numberBlurErrorMessage}}</p>    
            </div>
            <div class="NoPBox box">
                <dt style="margin-bottom:2.2rem">
                    인원 선택
                </dt>
               
                <dd >
                    <b-form-select style="width: 20rem; height: 4.2rem; font-size: 1.5rem; text-align:center;" v-model="totalPrice" :options="capacityAndTotalPriceList" value-field="price" text-field="capacity">
                        <template #first>
                            <b-form-select-option value="" disabled> 이용 인원을 선택해주세요.</b-form-select-option>
                        </template>
                    </b-form-select>
                </dd>    
                <div class="inputBox" style="margin: 2rem">
                    <div class="inputItem">
                    <span>이용 금액 : </span>
                    <span style="font-size: 2.0rem; font-weight: bold;">{{totalPrice}}&nbsp;원</span>
                    </div>
                </div>
            </div>
        </div>      
    </div>
</template>
<script>
import { mapActions, mapGetters, mapMutations, mapState } from 'vuex';
import {eventBus} from '@/main.js'

export default {
    name: '',
    components: {
       
    },
    data() {
        return {
             privacy_agree: false,

             number1: '010',
             id_number: ['010','011','016','017','018','019'],
             number2: '',
             number3: '',
             hasWrongNumber : null,
             totalNumber :"",

             name: '',
             hasWrongName: null,

             totalPrice: 0 ,
             capacityAndTotalPriceList : [ ],

             nameBlurErrorMessage: '',
             numberBlurErrorMessage: '',

        };
    },
     computed:{
        ...mapState(['selectedThemeInfo']),
        ...mapGetters(['getThemeTotalPrice']),
    },
    setup() {},
    created() {

    },
    mounted() {
        //vuex에 저장된 {인수 : 가격} list 가져오기
        this.getTotalPirce()
    },
    unmounted() {},
    methods: {
         ...mapMutations(['alert_Error', 'alert_Warning', 'isItemSelected']),
        //전화번호 blur시
        numberBlur(){
            this.checkRegEx(this.number2,/^[0-9]{4}$/,this.setNumberBlurErrorMessage, "올바른 전화번호를 입력해주세요.")
            this.checkRegEx(this.number3,/^[0-9]{4}$/,this.setNumberBlurErrorMessage, "올바른 전화번호를 입력해주세요.")
        },
        //전화번호 오류시 필요한 setter
       setNumberBlurErrorMessage(message, status){
           this.numberBlurErrorMessage = message
           this.hasWrongNumber = status
       },
       //이름 blur시  
       nameBlur(){
           this.checkRegEx(this.name, /^[가-힣a-zA-Z]+$/, this.setNameBlurErrorMessage, "올바른 이름을 입력해주세요.");
       },
       //이름 오류시 필요한 setter
       setNameBlurErrorMessage(message,status){
           this.nameBlurErrorMessage = message
           this.hasWrongName = status
       },
        //blur시 오류 메시지를 보이게 하는 공통 메서드
       checkRegEx(value, regex, setMessageMethod ,errorMessageText){
           let check = regex.test(value);
           if(!check){  //불합격
               setMessageMethod(errorMessageText,false)
           }else{       //합격
               setMessageMethod("",true)
           }
       }, 
       //인원 선택했는지 확인 메서드
       isSelectCapacity(){
           if(!this.totalPrice){
               this.alert_Warning("인원을 선택하세요.")
               return
           }else{
               return true
           }
       } ,
       //vuex로부터 인원수 * 가격 list를 가져오는 메서드
       getTotalPirce(){
           this.capacityAndTotalPriceList = this.$store.getters.getThemeTotalPriceList;
       },
       //다음 버튼 눌렀을 때 빈값이 없는지 확인하는 메서드
       isItemInput(){
          if(!!this.checkInputItem(this.privacy_agree, "", "개인정보 수집 및 이용에 동의하셔야합니다." )
                && !!this.checkInputItem(this.hasWrongName, this.setNameBlurErrorMessage,"이름을 확인해주세요.")
                && !!this.checkInputItem(this.hasWrongNumber, this.setNumberBlurErrorMessage, "번호를 확인해주세요.")
                && !!this.checkInputItem(this.totalPrice, "" ,"인원을 선택하세요.")
            ){
                return true
            }else{
                return
            } 
       },       
       checkInputItem(status, setter ,message){
            if(!status){
                if(!!setter) setter(message, false)
                this.alert_Warning(message)
                return false
            }else{
                if(!!setter) setter("", true)
                return true
            }
        },
        //입력 항목을 vuex에 저장하는 메서드
        saveItemsToVuex(){
            this.$store.commit("setPrivacyAgree", this.privacy_agree)
            this.$store.commit("setBookerName", this.name)
            this.$store.commit("setPhoneNumber", this.number1+'-'+this.number2+'-'+this.number3)
            // this.$store.commit("setTotalPrice", this.totalPrice)
            let ob = this.findObjectInCAPList(this.totalPrice)
            this.$store.commit("setCapacityAndPrice", ob)
            console.log(this.$store.state.capacityAndPrice)

        },
        findObjectInCAPList(totalPrice){
            let capacityAndPrice = {}
            for(let i in this.capacityAndTotalPriceList){
                if(this.capacityAndTotalPriceList[i].price == totalPrice){
                    capacityAndPrice = this.capacityAndTotalPriceList[i]
                }    
            }
            return capacityAndPrice
        }
    },
    watch:{
        
    },
   
    
}
</script>
<style scoped>
    .input_container{
        background-color: rgb(247, 247, 247);
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        width: 100%;
        
    }

    .box{
        background-color: rgb(255, 255, 255);
        border-radius: 4px;
        border: 2px solid rgb(207, 199, 199);
        margin: 0rem 1rem;
    }

    .left_box{
        width: 33rem;
        height: 38rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 2rem;
    }
    .right_box{
        display: flex;
        flex-direction: column;
        margin-bottom: 2rem;
    }
    .inputBox{
        width: 33rem;
        height: 18rem;
        display: flex;
        flex-direction: column;
        align-items: center;
         margin-bottom: 0.8rem;
    }
     .NoPBox{
        width: 33rem;
        height: 18rem;
        display: flex;
        flex-direction: column;
        align-items: center;
         margin-top: 0.8rem;
    }
    dt {
        padding: 1rem;
        font-size: 1.7rem;
        font-weight: bold;
        text-align: center;
        margin: 0 0.6rem;
        color: rgb(126, 122, 122);
        border-bottom: 2px solid rgb(207, 199, 199);
        /* border-radius: 10px; */
        margin-bottom: 0.8rem;
    }
    .dd{
        margin-top: 2%;
        height: 28rem;
        margin-left: 2%;
        margin-right: 2%;
        background-color: rgb(248, 248, 248);
        overflow: auto;
        border: 0.08rem solid rgb(163, 159, 159);
        border-radius: 2px;
        -ms-user-select: none; 
       -moz-user-select: -moz-none;
       -khtml-user-select: none;
       -webkit-user-select: none;
        user-select: none;
    }
    .ddTitle{
        font-size: 1.1rem;
        font-weight: 510;
        padding-top: 0.5rem;
    }
    .ddSubTitle{
        font-size: 0.89rem;
        font-weight: 500;;
    }

    .ddSubContent{
        font-size: 0.75rem;
        margin-top: 0.6rem;
        margin-left: 1rem;
    }
    .agreeCheckBox{
      margin-top: 0.5rem;
      -ms-user-select: none; 
      -moz-user-select: -moz-none;
      -khtml-user-select: none;
      -webkit-user-select: none;
       user-select: none;
    } 
    .inputItem{
        padding: 0rem 1.7rem;
        display: flex;
        flex-direction: row;
    }
    .inputItem span{
        font-size: 1.5rem;
        color: rgb(126, 122, 122);
        margin: 0rem 0.5rem;
    }
    input{
        width: 20rem;
        height: 3rem;
        /* color: rgb(126, 122, 122); */
        font-size: 1.5rem;
    }  
    .error{
        border-color:#e70448;
        outline:none;
    }
    .form-control{
        display: inline !important;
    }
    .inline{
       display: inline !important;
    }
    .errorMessage{
       
        font-size: 0.75rem !important;
        color: rgb(216, 16, 16) !important;;
        margin-bottom: 0;
    }
    .wrongNumberLine{
        border: 0.1rem solid rgb(216, 16, 16) ;
        border-radius: 0.25rem;
        padding: 0.72rem 0.12rem;
        padding-top: 1.2rem;

    }

    @media (max-width: 798px) {
        .agreementForCollection{
          
        }
        .left_box{
            margin: 0 0;
            margin-bottom: 1rem;
        }

        .NoPBox{
            width: 100%;
            margin: 0 0;
            margin-bottom: 1rem;
        }
        .inputBox{
            width: 100%;
            margin: 0 0;
            margin-bottom: 1rem;
            height: 20rem;
        }
        .inputItem{
            padding: 0 0 ;
        }
        .inputItem span{
            
        }
        #input-name{
            width: 10rem;
        }
        #input-num{
            width: 3rem;
        }
        .label{
            width: 4rem;
           
        }
        .label span{
             font-size: 1rem;
             width: 4rem;
           
        }

    }    


    
</style>